<h2 class="py-5 text-center text-6xl">List of users</h2>

<div class="p-6">
  <div
    (click)="toggleForm()"
    class="mb-4 flex max-w-fit cursor-pointer items-center justify-center gap-2 rounded px-4 py-2 text-bright underline"
  >
    <span>Add New User</span>
    <svg-icon
      [src]="'assets/icons/chevron-left.svg'"
      [svgClass]="
        'h-6 w-6 text-shade ' +
        (isFormVisible() ? 'rotate-90' : '-rotate-90') +
        ' stroke-[2] transition-transform'
      "
      [applyClass]="true"
    ></svg-icon>
  </div>

  @if (isFormVisible()) {
    <form
      [formGroup]="userForm"
      (ngSubmit)="onSubmit()"
      class="mb-6 rounded-lg bg-primary p-6 shadow-lg"
    >
      <!-- Name Fields -->
      <div class="mb-4 flex gap-4">
        <div class="flex-1">
          <input
            type="text"
            formControlName="first_name"
            placeholder="First Name"
            pInputText
            class="w-full"
          />
          @if (
            userForm.get('first_name')?.touched &&
            userForm.get('first_name')?.invalid
          ) {
            <span class="mt-1 text-sm text-red-500"
              >First name is required</span
            >
          }
        </div>
        <div class="flex-1">
          <input
            type="text"
            formControlName="last_name"
            placeholder="Last Name"
            pInputText
            class="w-full"
          />
          @if (
            userForm.get('last_name')?.touched &&
            userForm.get('last_name')?.invalid
          ) {
            <span class="mt-1 text-sm text-red-500">Last name is required</span>
          }
        </div>
      </div>
      <div class="mb-4 flex gap-4">
        <!-- Email Field -->
        <div class="flex-1">
          <input
            type="email"
            formControlName="email"
            placeholder="Email"
            pInputText
            class="w-full"
          />
          @if (
            userForm.get('email')?.touched && userForm.get('email')?.invalid
          ) {
            <span class="mt-1 text-sm text-red-500"
              >Please enter a valid email</span
            >
          }
        </div>
        <!-- Date of Birth Field -->
        <div class="w-full flex-1">
          <p-datepicker
            formControlName="dob"
            placeholder="Date of Birth"
            [showIcon]="true"
            class="w-full"
          />
          @if (userForm.get('dob')?.touched && userForm.get('dob')?.invalid) {
            <div class="mt-1 text-sm text-red-500">
              Date of birth is required
            </div>
          }
        </div>
      </div>

      <!-- Interests Field -->
      <div class="mb-6">
        <input
          type="text"
          formControlName="interests"
          placeholder="Interests"
          pInputText
          class="w-full"
        />
      </div>

      <!-- Form Buttons -->
      <div class="flex gap-3">
        <button
          type="submit"
          [disabled]="!userForm.valid"
          class="rounded bg-accent px-6 py-2 text-bright transition-colors hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50"
        >
          Create
        </button>
        <button
          type="button"
          (click)="toggleForm()"
          class="rounded border border-accent bg-transparent px-6 py-2 text-bright transition-colors hover:bg-muted"
        >
          Cancel
        </button>
      </div>
    </form>
  }

  <div class="overflow-x-auto">
    <table class="w-full border-collapse rounded-lg border border-gray-700">
      <thead>
        <tr class="bg-gray-900">
          @for (header of tableHeaders; track header) {
            <th class="border-b border-gray-700 p-4 text-left">{{ header }}</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (user of users(); track user.id) {
          <tr class="cursor-pointer border-b border-gray-700 hover:bg-gray-800">
            <td class="p-4">{{ user.id }}</td>
            <td class="p-4">{{ user.first_name }} {{ user.last_name }}</td>
            <td class="p-4">{{ user.email }}</td>
            <td class="p-4">{{ user.dob | formatDate }}</td>
            <td class="p-4">{{ user.interests }}</td>
            <td class="p-4">
              <div class="flex gap-2">
                <button
                  (click)="updateUser(user, $event)"
                  class="rounded bg-blue-600 px-3 py-1 text-white hover:bg-blue-700"
                >
                  Update
                </button>
                <button
                  (click)="deleteUser(user.id, $event)"
                  class="rounded bg-red-600 px-3 py-1 text-white hover:bg-red-700"
                >
                  Delete
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="6" class="p-4 text-center">No users found</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
